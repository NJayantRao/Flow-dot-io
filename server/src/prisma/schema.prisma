// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output = "../../src/generated/client"
}

datasource db {
  provider = "postgresql"
}
enum Role {
  USER
  ADMIN
}

enum VoteStatus {
  UPVOTED
  DOWNVOTED
}

enum ReputationAction {
  QUESTION_UPVOTED
  QUESTION_DOWNVOTED
  ANSWER_UPVOTED
  ANSWER_DOWNVOTED
  ANSWER_ACCEPTED
  DOWNVOTE_CAST
}
model User{
  id String @id @default(uuid())
  username String @unique 
  email String @unique
  password String
  avatarUrl String
  role Role @default(USER)
  isVerified Boolean @default(false)
  reputation Int @default(0)
  questions Question[]
  answers Answer[]
  comments Comment[]
  votes Vote[]
  reputationLogs ReputationLedger[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Question{
  id String @id @default(uuid())
  title String
  content String
  attachmentId String?
  author   User @relation(fields: [authorId], references: [id])
  authorId String
  answers Answer[]
  comments Comment[]
  voteCount Int @default(0)
  votes Vote[]
  reputationLogs ReputationLedger[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Answer{
  id String @id @default(uuid())
  content String
  author User @relation(fields: [authorId],references: [id])
  authorId String
  question Question @relation(fields: [questionId],references: [id])
  questionId String 
  isAccepted Boolean @default(false) 
  comments Comment[]
  voteCount Int @default(0)
  votes Vote[]
  reputationLogs ReputationLedger[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment{
  id String @id @default(uuid())
  author User @relation(fields: [authorId],references: [id])
  authorId String
  content String
  question Question? @relation(fields: [questionId],references: [id])
  questionId String? 
  answer Answer? @relation(fields: [answerId],references: [id])
  answerId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vote{
  id String @id @default(uuid())
  votedBy User @relation(fields: [votedById],references: [id])
  votedById String
  question Question? @relation(fields: [questionId],references: [id])
  questionId String? 
  answer Answer? @relation(fields: [answerId],references: [id])
  answerId String?
  voteStatus VoteStatus
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([votedById,questionId])
  @@unique([votedById,answerId])
}

model ReputationLedger{
  id String @id @default(uuid())
  user User @relation(fields: [userId],references: [id])
  userId String
  action ReputationAction
  points Int
  question Question? @relation(fields: [questionId],references: [id])
  questionId String? 
  answer Answer? @relation(fields: [answerId],references: [id])
  answerId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
  